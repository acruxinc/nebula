name: Documentation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

env:
  CARGO_TERM_COLOR: always

jobs:
  # Generate and deploy documentation
  docs:
    name: Generate Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          components: rust-docs

      - name: Cache cargo registry
        uses: actions/cache@v3
        with:
          path: ~/.cargo/registry
          key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}

      - name: Cache cargo index
        uses: actions/cache@v3
        with:
          path: ~/.cargo/git
          key: ${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}

      - name: Cache cargo build
        uses: actions/cache@v3
        with:
          path: target
          key: ${{ runner.os }}-cargo-build-target-${{ hashFiles('**/Cargo.lock') }}

      - name: Install mdbook
        run: cargo install mdbook mdbook-admonish

      - name: Check documentation links
        run: cargo doc --no-deps --document-private-items

      - name: Generate book documentation
        run: |
          if [ -f "book.toml" ]; then
            mdbook build docs/
          else
            echo "No book.toml found, skipping book generation"
          fi

      - name: Check for broken links in docs
        run: |
          cargo install cargo-deadlinks
          cargo deadlinks

      - name: Deploy to GitHub Pages
        if: github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./target/doc
          destination_dir: api-docs

  # Spell check documentation
  spell-check:
    name: Spell Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install cspell
        run: npm install -g cspell

      - name: Create cspell config
        run: |
          cat > cspell.json << EOF
          {
            "version": "0.2",
            "language": "en",
            "words": [
              "nebula",
              "rustls",
              "rcgen",
              "tokio",
              "hyper",
              "serde",
              "clap",
              "trust-dns",
              "systemd",
              "launchd",
              "dnsmasq",
              "caddy",
              "dnssec",
              "dhcp",
              "tls",
              "https",
              "json",
              "toml",
              "yaml",
              "github",
              "workflows",
              "ci",
              "cd",
              "api",
              "sdk",
              "cli",
              "gui",
              "ui",
              "ux",
              "devops",
              "kubernetes",
              "docker",
              "container",
              "microservice",
              "backend",
              "frontend",
              "fullstack",
              "websocket",
              "restful",
              "graphql",
              "postgresql",
              "mongodb",
              "redis",
              "elasticsearch",
              "kibana",
              "prometheus",
              "grafana",
              "jaeger",
              "zipkin",
              "opentelemetry",
              "telemetry",
              "observability",
              "monitoring",
              "logging",
              "tracing",
              "metrics",
              "alerting",
              "dashboard",
              "visualization",
              "analytics",
              "insights",
              "reporting",
              "auditing",
              "compliance",
              "security",
              "authentication",
              "authorization",
              "oauth",
              "jwt",
              "rbac",
              "abac",
              "acl",
              "pki",
              "ca",
              "certificate",
              "ssl",
              "tls",
              "cipher",
              "encryption",
              "decryption",
              "hashing",
              "salting",
              "peppering",
              "bcrypt",
              "scrypt",
              "argon",
              "pbkdf",
              "hmac",
              "sha",
              "md",
              "aes",
              "rsa",
              "ecdsa",
              "eddsa",
              "curve",
              "elliptic",
              "prime",
              "modular",
              "exponential",
              "logarithmic",
              "cryptographic",
              "cryptography",
              "cryptanalysis",
              "steganography",
              "quantum",
              "post-quantum",
              "lattice",
              "code-based",
              "multivariate",
              "isogeny",
              "hash-based",
              "symmetric",
              "asymmetric",
              "public-key",
              "private-key",
              "key-pair",
              "key-exchange",
              "key-agreement",
              "key-derivation",
              "key-rotation",
              "key-escrow",
              "key-recovery",
              "key-management",
              "key-storage",
              "key-backup",
              "key-restore",
              "key-migration",
              "key-import",
              "key-export",
              "key-format",
              "key-encoding",
              "key-serialization",
              "key-deserialization",
              "key-validation",
              "key-verification",
              "key-integrity",
              "key-authenticity",
              "key-confidentiality",
              "key-availability",
              "key-non-repudiation",
              "key-revocation",
              "key-expiration",
              "key-renewal",
              "key-replacement",
              "key-update",
              "key-versioning",
              "key-rollover",
              "key-rotation",
              "key-lifecycle",
              "key-policy",
              "key-governance",
              "key-compliance",
              "key-audit",
              "key-logging",
              "key-monitoring",
              "key-alerting",
              "key-notification",
              "key-reporting",
              "key-analytics",
              "key-metrics",
              "key-dashboard",
              "key-visualization",
              "key-insights",
              "key-recommendations",
              "key-optimization",
              "key-performance",
              "key-efficiency",
              "key-effectiveness",
              "key-reliability",
              "key-availability",
              "key-durability",
              "key-persistence",
              "key-resilience",
              "key-fault-tolerance",
              "key-disaster-recovery",
              "key-business-continuity",
              "key-high-availability",
              "key-load-balancing",
              "key-scaling",
              "key-horizontal",
              "key-vertical",
              "key-auto-scaling",
              "key-elasticity",
              "key-flexibility",
              "key-adaptability",
              "key-configurability",
              "key-customizability",
              "key-extensibility",
              "key-plugability",
              "key-modularity",
              "key-composability",
              "key-reusability",
              "key-maintainability",
              "key-testability",
              "key-debuggability",
              "key-traceability",
              "key-observability",
              "key-monitorability",
              "key-instrumentation",
              "key-profiling",
              "key-benchmarking",
              "key-performance-testing",
              "key-load-testing",
              "key-stress-testing",
              "key-volume-testing",
              "key-capacity-testing",
              "key-scalability-testing",
              "key-reliability-testing",
              "key-availability-testing",
              "key-durability-testing",
              "key-persistence-testing",
              "key-recovery-testing",
              "key-failover-testing",
              "key-disaster-recovery-testing",
              "key-business-continuity-testing",
              "key-continuity-testing",
              "key-resilience-testing",
              "key-fault-tolerance-testing",
              "key-error-handling-testing",
              "key-exception-handling-testing",
              "key-edge-case-testing",
              "key-boundary-testing",
              "key-limit-testing",
              "key-threshold-testing",
              "key-capacity-testing",
              "key-volume-testing",
              "key-stress-testing",
              "key-spike-testing",
              "key-surge-testing",
              "key-burst-testing",
              "key-flood-testing",
              "key-overload-testing",
              "key-exhaustion-testing",
              "key-depletion-testing",
              "key-starvation-testing",
              "key-deadlock-testing",
              "key-livelock-testing",
              "key-race-condition-testing",
              "key-concurrency-testing",
              "key-parallelism-testing",
              "key-multithreading-testing",
              "key-asynchronous-testing",
              "key-synchronous-testing",
              "key-blocking-testing",
              "key-non-blocking-testing",
              "key-event-driven-testing",
              "key-reactive-testing",
              "key-streaming-testing",
              "key-batch-testing",
              "key-real-time-testing",
              "key-near-real-time-testing",
              "key-low-latency-testing",
              "key-high-throughput-testing",
              "key-bandwidth-testing",
              "key-network-testing",
              "key-connectivity-testing",
              "key-reachability-testing",
              "key-accessibility-testing",
              "key-availability-testing",
              "key-uptime-testing",
              "key-downtime-testing",
              "key-maintenance-testing",
              "key-patching-testing",
              "key-updating-testing",
              "key-upgrading-testing",
              "key-migration-testing",
              "key-rollback-testing",
              "key-rollforward-testing",
              "key-versioning-testing",
              "key-compatibility-testing",
              "key-interoperability-testing",
              "key-integration-testing",
              "key-system-testing",
              "key-acceptance-testing",
              "key-regression-testing",
              "key-smoke-testing",
              "key-sanity-testing",
              "key-sanity-checking",
              "key-health-checking",
              "key-liveness-checking",
              "key-readiness-checking",
              "key-startup-checking",
              "key-shutdown-checking",
              "key-initialization-checking",
              "key-cleanup-checking",
              "key-teardown-checking",
              "key-setup-checking",
              "key-configuration-checking",
              "key-validation-checking",
              "key-verification-checking",
              "key-authentication-checking",
              "key-authorization-checking",
              "key-permission-checking",
              "key-access-checking",
              "key-security-checking",
              "key-vulnerability-checking",
              "key-threat-checking",
              "key-risk-checking",
              "key-compliance-checking",
              "key-audit-checking",
              "key-governance-checking",
              "key-policy-checking",
              "key-standard-checking",
              "key-regulation-checking",
              "key-requirement-checking",
              "key-specification-checking",
              "key-documentation-checking",
              "key-code-review-checking",
              "key-peer-review-checking",
              "key-quality-checking",
              "key-clean-code-checking",
              "key-best-practice-checking",
              "key-design-pattern-checking",
              "key-architecture-checking",
              "key-design-checking",
              "key-implementation-checking",
              "key-coding-checking",
              "key-programming-checking",
              "key-development-checking",
              "key-engineering-checking",
              "key-software-engineering-checking",
              "key-systems-engineering-checking",
              "key-devops-checking",
              "key-sre-checking",
              "key-platform-engineering-checking",
              "key-infrastructure-engineering-checking",
              "key-cloud-engineering-checking",
              "key-container-engineering-checking",
              "key-orchestration-checking",
              "key-orchestrator-checking",
              "key-scheduler-checking",
              "key-coordinator-checking",
              "key-manager-checking",
              "key-controller-checking",
              "key-operator-checking",
              "key-service-checking",
              "key-microservice-checking",
              "key-nanoservice-checking",
              "key-serverless-checking",
              "key-function-checking",
              "key-lambda-checking",
              "key-event-checking",
              "key-webhook-checking",
              "key-api-checking",
              "key-rest-api-checking",
              "key-graphql-api-checking",
              "key-grpc-api-checking",
              "key-soap-api-checking",
              "key-rpc-checking",
              "key-http-checking",
              "key-https-checking",
              "key-tcp-checking",
              "key-udp-checking",
              "key-websocket-checking",
              "key-sse-checking",
              "key-polling-checking",
              "key-streaming-checking",
              "key-messaging-checking",
              "key-queue-checking",
              "key-topic-checking",
              "key-subscription-checking",
              "key-publish-checking",
              "key-subscribe-checking",
              "key-broker-checking",
              "key-bus-checking",
              "key-event-bus-checking",
              "key-message-bus-checking",
              "key-service-bus-checking",
              "key-enterprise-service-bus-checking",
              "key-esb-checking",
              "key-middleware-checking",
              "key-gateway-checking",
              "key-proxy-checking",
              "key-load-balancer-checking",
              "key-reverse-proxy-checking",
              "key-forward-proxy-checking",
              "key-transparent-proxy-checking",
              "key-cache-checking",
              "key-caching-checking",
              "key-memory-cache-checking",
              "key-disk-cache-checking",
              "key-distributed-cache-checking",
              "key-cache-aside-checking",
              "key-write-through-checking",
              "key-write-behind-checking",
              "key-write-around-checking",
              "key-cache-invalidation-checking",
              "key-cache-eviction-checking",
              "key-cache-replacement-checking",
              "key-cache-coherence-checking",
              "key-cache-consistency-checking",
              "key-cache-partitioning-checking",
              "key-cache-sharding-checking",
              "key-cache-replication-checking",
              "key-cache-clustering-checking",
              "key-cache-federation-checking",
              "key-cache-distribution-checking",
              "key-cache-load-balancing-checking",
              "key-cache-scaling-checking",
              "key-cache-performance-checking",
              "key-cache-optimization-checking",
              "key-cache-tuning-checking",
              "key-cache-monitoring-checking",
              "key-cache-metrics-checking",
              "key-cache-analytics-checking",
              "key-cache-reporting-checking",
              "key-cache-alerting-checking",
              "key-cache-notification-checking",
              "key-cache-logging-checking",
              "key-cache-tracing-checking",
              "key-cache-auditing-checking",
              "key-cache-compliance-checking",
              "key-cache-security-checking",
              "key-cache-encryption-checking",
              "key-cache-compression-checking",
              "key-cache-serialization-checking",
              "key-cache-deserialization-checking",
              "key-cache-format-checking",
              "key-cache-encoding-checking",
              "key-cache-protocol-checking",
              "key-cache-interface-checking",
              "key-cache-abstraction-checking",
              "key-cache-implementation-checking",
              "key-cache-design-checking",
              "key-cache-architecture-checking",
              "key-cache-pattern-checking",
              "key-cache-strategy-checking",
              "key-cache-policy-checking",
              "key-cache-algorithm-checking",
              "key-cache-data-structure-checking",
              "key-cache-indexing-checking",
              "key-cache-hashing-checking",
              "key-cache-bloom-filter-checking",
              "key-cache-lru-checking",
              "key-cache-lfu-checking",
              "key-cache-fifo-checking",
              "key-cache-lifo-checking",
              "key-cache-random-checking",
              "key-cache-ttl-checking",
              "key-cache-expiration-checking",
              "key-cache-refresh-checking",
              "key-cache-reload-checking",
              "key-cache-warmup-checking",
              "key-cache-preloading-checking",
              "key-cache-prefetching-checking",
              "key-cache-prediction-checking",
              "key-cache-forecasting-checking",
              "key-cache-analytics-checking",
              "key-cache-insights-checking",
              "key-cache-recommendations-checking",
              "key-cache-optimization-checking",
              "key-cache-tuning-checking",
              "key-cache-calibration-checking",
              "key-cache-adjustment-checking",
              "key-cache-configuration-checking",
              "key-cache-settings-checking",
              "key-cache-parameters-checking",
              "key-cache-variables-checking",
              "key-cache-constants-checking",
              "key-cache-environments-checking",
              "key-cache-environments-checking",
              "key-cache-staging-checking",
              "key-cache-production-checking",
              "key-cache-development-checking",
              "key-cache-testing-checking",
              "key-cache-qa-checking",
              "key-cache-uat-checking",
              "key-cache-preproduction-checking",
              "key-cache-sandbox-checking",
              "key-cache-mock-checking",
              "key-cache-stub-checking",
              "key-cache-fake-checking",
              "key-cache-dummy-checking",
              "key-cache-virtual-checking",
              "key-cache-simulated-checking",
              "key-cache-emulated-checking",
              "key-cache-mimicked-checking",
              "key-cache-replicated-checking",
              "key-cache-cloned-checking",
              "key-cache-copied-checking",
              "key-cache-duplicated-checking",
              "key-cache-mirrored-checking",
              "key-cache-backed-up-checking",
              "key-cache-archived-checking",
              "key-cache-compressed-checking",
              "key-cache-encrypted-checking",
              "key-cache-secured-checking",
              "key-cache-protected-checking",
              "key-cache-authenticated-checking",
              "key-cache-authorized-checking",
              "key-cache-permissioned-checking",
              "key-cache-access-controlled-checking",
              "key-cache-rate-limited-checking",
              "key-cache-throttled-checking",
              "key-cache-quota-checking",
              "key-cache-budget-checking",
              "key-cache-cost-checking",
              "key-cache-billing-checking",
              "key-cache-pricing-checking",
              "key-cache-licensing-checking",
              "key-cache-legal-checking",
              "key-cache-compliance-checking",
              "key-cache-regulation-checking",
              "key-cache-standard-checking",
              "key-cache-specification-checking",
              "key-cache-requirement-checking",
              "key-cache-contract-checking",
              "key-cache-sla-checking",
              "key-cache-slo-checking",
              "key-cache-sli-checking",
              "key-cache-metrics-checking",
              "key-cache-kpis-checking",
              "key-cache-dashboard-checking",
              "key-cache-visualization-checking",
              "key-cache-reporting-checking",
              "key-cache-alerting-checking",
              "key-cache-monitoring-checking",
              "key-cache-observability-checking",
              "key-cache-traceability-checking",
              "key-cache-debuggability-checking",
              "key-cache-troubleshooting-checking",
              "key-cache-diagnosis-checking",
              "key-cache-analysis-checking",
              "key-cache-investigation-checking",
              "key-cache-resolution-checking",
              "key-cache-fix-checking",
              "key-cache-patch-checking",
              "key-cache-update-checking",
              "key-cache-upgrade-checking",
              "key-cache-migration-checking",
              "key-cache-rollback-checking",
              "key-cache-rollforward-checking",
              "key-cache-versioning-checking",
              "key-cache-lifecycle-checking",
              "key-cache-governance-checking",
              "key-cache-management-checking",
              "key-cache-administration-checking",
              "key-cache-operation-checking",
              "key-cache-maintenance-checking",
              "key-cache-support-checking",
              "key-cache-troubleshooting-checking",
              "key-cache-help-checking",
              "key-cache-documentation-checking",
              "key-cache-tutorial-checking",
              "key-cache-guide-checking",
              "key-cache-manual-checking",
              "key-cache-reference-checking",
              "key-cache-api-checking",
              "key-cache-sdk-checking",
              "key-cache-library-checking",
              "key-cache-framework-checking",
              "key-cache-toolkit-checking",
              "key-cache-utility-checking",
              "key-cache-helper-checking",
              "key-cache-helper-checking",
              "key-cache-helper-checking"
            ],
            "ignoreWords": [
              "lorem",
              "ipsum",
              "dolor",
              "sit",
              "amet",
              "consectetur",
              "adipiscing",
              "elit",
              "sed",
              "do",
              "eiusmod",
              "tempor",
              "incididunt",
              "ut",
              "labore",
              "et",
              "dolore",
              "magna",
              "aliqua",
              "enim",
              "ad",
              "minim",
              "veniam",
              "quis",
              "nostrud",
              "exercitation",
              "ullamco",
              "laboris",
              "nisi",
              "aliquip",
              "ex",
              "ea",
              "commodo",
              "consequat",
              "duis",
              "aute",
              "irure",
              "in",
              "reprehenderit",
              "voluptate",
              "velit",
              "esse",
              "cillum",
              "fugiat",
              "nulla",
              "pariatur",
              "excepteur",
              "sint",
              "occaecat",
              "cupidatat",
              "non",
              "proident",
              "sunt",
              "culpa",
              "qui",
              "officia",
              "deserunt",
              "mollit",
              "anim",
              "id",
              "est",
              "laborum"
            ],
            "ignorePaths": [
              "target/**",
              "Cargo.lock",
              "*.lock",
              "node_modules/**",
              ".git/**",
              "dist/**",
              "build/**",
              "*.log"
            ]
          }
          EOF

      - name: Run spell check
        run: |
          cspell "**/*.md" "**/*.txt" "**/*.rst" "**/*.adoc" --config cspell.json

  # Check for TODO/FIXME comments
  todo-check:
    name: TODO/FIXME Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for TODO/FIXME comments
        run: |
          echo "Checking for TODO/FIXME comments in code..."
          if grep -r "TODO\|FIXME\|HACK\|XXX" src/ --include="*.rs" --exclude-dir=target; then
            echo "Found TODO/FIXME comments. Please address them before merging."
            exit 1
          else
            echo "No TODO/FIXME comments found."
          fi
